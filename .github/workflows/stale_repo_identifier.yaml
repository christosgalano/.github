name: stale-repo-identifier
run-name: ${{ github.workflow}}
on:
  workflow_dispatch:
    inputs:
      organization:
        description: 'The organization to check for stale repositories'
        required: true
        default: 'christosgalano'
  schedule:
    - cron: '0 9 1 * *'

jobs:
  run:
    name: stale-repo-identifier
    runs-on: ubuntu-latest
    permissions:
      contents: read
      issues: write
    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Run stale_repos tool
      uses: docker://ghcr.io/github/stale_repos:v1
      env:
        GH_TOKEN: ${{ secrets.STALE_REPOS_PAT }}
        ORGANIZATION: ${{ inputs.organization || github.repository_owner }}
        INACTIVE_DAYS: 365

    - name: Create issue
      uses: peter-evans/create-issue-from-file@v4
      with:
        title: Stale repository report
        content-filepath: ./stale_repos.md
        assignees: ${{ github.repository_owner }}